# Тестирование загрузки аватара

## Быстрый тест

1. **Убедитесь, что папки для загрузки существуют:**
   - `/public/uploads/avatars/`
   - `/public/uploads/logos/`

2. **Запустите сервер:**

```bash
npm run dev
```

3. **Авторизуйтесь в системе:**

   - Перейдите на `http://localhost:3000/login`
   - Войдите с существующим пользователем

4. **Перейдите на страницу профиля:**

   - `http://localhost:3000/profile`
   - Или нажмите на кнопку профиля в Header

5. **Загрузите аватар:**
   - Нажмите "Изменить фото" под аватаром
   - Выберите изображение (jpg, png, gif, webp)
   - Дождитесь загрузки (появится спиннер)
   - Должно появиться уведомление об успешной загрузке
   - Аватар должен обновиться автоматически

## Что тестировать

### ✅ Позитивные сценарии:

- [ ] Загрузка JPG изображения
- [ ] Загрузка PNG изображения
- [ ] Загрузка GIF изображения
- [ ] Загрузка WEBP изображения
- [ ] Замена существующего аватара новым
- [ ] Обновление страницы - аватар остается

### ⚠️ Негативные сценарии:

- [ ] Попытка загрузить не-изображение (должна быть ошибка)
- [ ] Попытка загрузить файл > 5MB (должна быть ошибка)
- [ ] Загрузка без авторизации (должен быть редирект на /login)

## Проверка загруженных файлов

1. Откройте папку `/public/uploads/avatars/`
2. Должны увидеть загруженные изображения с именами вида `avatar_{userid}_{timestamp}_{random}.jpg`
3. Изображения должны быть оптимизированы (400x400px)
4. Файлы должны быть в формате JPEG для аватаров

## Проверка в базе данных

После успешной загрузки проверьте, что в таблице `users` обновилось поле `avatar_url`:

```sql
SELECT id, email, avatar_url FROM users WHERE id = YOUR_USER_ID;
```

URL должен выглядеть примерно так:

```
/uploads/avatars/avatar_1_1234567890_abc123.jpg
```

## Troubleshooting

### Аватар не загружается

1. Проверьте консоль браузера (F12 → Console)
2. Проверьте Network вкладку для деталей запроса
3. Убедитесь, что папка `/public/uploads/avatars/` существует
4. Проверьте права доступа к папке (должна быть доступна для записи)

### Ошибка 401 Unauthorized

- Проверьте, что вы авторизованы (есть токен в cookies)
- Попробуйте выйти и войти заново

### Ошибка "Image processing error"

- Убедитесь, что установлен пакет `sharp`: `npm install sharp`
- Проверьте, что файл действительно является изображением
- Попробуйте другое изображение

### Изображение загрузилось, но не отображается

1. Проверьте URL в базе данных
2. Откройте URL напрямую в браузере
3. Проверьте консоль на ошибки CORS
4. Обновите страницу (Ctrl+Shift+R для жесткого обновления)
