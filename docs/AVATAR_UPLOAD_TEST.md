# Тестирование загрузки аватара

## Быстрый тест

1. **Убедитесь, что настроены переменные окружения Cloudinary** (см. `CLOUDINARY_SETUP.md`)

2. **Запустите сервер:**

```bash
npm run dev
```

3. **Авторизуйтесь в системе:**

   - Перейдите на `http://localhost:3000/login`
   - Войдите с существующим пользователем

4. **Перейдите на страницу профиля:**

   - `http://localhost:3000/profile`
   - Или нажмите на кнопку профиля в Header

5. **Загрузите аватар:**
   - Нажмите "Изменить фото" под аватаром
   - Выберите изображение (jpg, png, gif, webp)
   - Дождитесь загрузки (появится спиннер)
   - Должно появиться уведомление об успешной загрузке
   - Аватар должен обновиться автоматически

## Что тестировать

### ✅ Позитивные сценарии:

- [ ] Загрузка JPG изображения
- [ ] Загрузка PNG изображения
- [ ] Загрузка GIF изображения
- [ ] Загрузка WEBP изображения
- [ ] Замена существующего аватара новым
- [ ] Обновление страницы - аватар остается

### ⚠️ Негативные сценарии:

- [ ] Попытка загрузить не-изображение (должна быть ошибка)
- [ ] Попытка загрузить файл > 5MB (должна быть ошибка)
- [ ] Загрузка без авторизации (должен быть редирект на /login)

## Проверка в Cloudinary

1. Зайдите в Dashboard Cloudinary
2. Перейдите в Media Library
3. Откройте папку `avatars`
4. Должны увидеть загруженные изображения с именами вида `user_{id}_{timestamp}`
5. Изображения должны быть оптимизированы (400x400px)

## Проверка в базе данных

После успешной загрузки проверьте, что в таблице `users` обновилось поле `avatar_url`:

```sql
SELECT id, email, avatar_url FROM users WHERE id = YOUR_USER_ID;
```

URL должен выглядеть примерно так:

```
https://res.cloudinary.com/YOUR_CLOUD_NAME/image/upload/v1234567890/avatars/user_1_1234567890.jpg
```

## Troubleshooting

### Аватар не загружается

1. Проверьте консоль браузера (F12 → Console)
2. Проверьте Network вкладку для деталей запроса
3. Убедитесь, что переменные окружения Cloudinary настроены

### Ошибка 401 Unauthorized

- Проверьте, что вы авторизованы (есть токен в cookies)
- Попробуйте выйти и войти заново

### Ошибка "Invalid credentials"

- Проверьте правильность API ключей Cloudinary в `.env.local`
- Убедитесь, что нет лишних пробелов

### Изображение загрузилось, но не отображается

1. Проверьте URL в базе данных
2. Откройте URL напрямую в браузере
3. Проверьте консоль на ошибки CORS
4. Обновите страницу (Ctrl+Shift+R для жесткого обновления)
