# Настройка Cloudinary для загрузки аватаров

## Шаги настройки

### 1. Создание аккаунта Cloudinary

1. Перейдите на [cloudinary.com](https://cloudinary.com/)
2. Зарегистрируйтесь или войдите в существующий аккаунт
3. После входа вы попадете на Dashboard

### 2. Получение учетных данных

На Dashboard вы увидите раздел **Account Details** с тремя параметрами:

- **Cloud Name** - имя вашего облака
- **API Key** - публичный ключ API
- **API Secret** - секретный ключ API (нажмите "Show" чтобы увидеть)

### 3. Добавление переменных окружения

Создайте файл `.env.local` в корне проекта (если его нет) и добавьте:

```env
# Cloudinary
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret
```

Замените значения на ваши реальные данные из Dashboard.

### 4. Перезапуск сервера

После добавления переменных окружения перезапустите dev-сервер:

```bash
npm run dev
```

## Функционал загрузки аватаров

### Возможности:

- ✅ Загрузка изображений (jpg, png, gif, webp)
- ✅ Автоматическое изменение размера до 400x400px
- ✅ Умная обрезка с фокусом на лице (gravity: face)
- ✅ Автоматическая оптимизация качества
- ✅ Ограничение размера файла (максимум 5MB)
- ✅ Валидация типа файла на клиенте и сервере
- ✅ Загрузка с прогресс-индикатором

### Безопасность:

- Проверка авторизации перед загрузкой
- Валидация типа и размера файла
- Изображения хранятся в папке `avatars/` в Cloudinary
- Уникальные имена файлов: `user_{userId}_{timestamp}`

## Структура файлов

```
src/
├── app/
│   ├── api/
│   │   └── upload-avatar/
│   │       └── route.js         # API endpoint для загрузки
│   └── actions/
│       └── updateAvatar.js      # Server Action для обновления URL в БД
├── components/
│   └── AvatarUpload.jsx         # Клиентский компонент загрузки
└── lib/
    └── cloudinary.js            # Конфигурация Cloudinary
```

## Troubleshooting

### Ошибка "Invalid credentials"

- Проверьте правильность введенных API Key и API Secret
- Убедитесь, что нет лишних пробелов в `.env.local`

### Ошибка "Upload failed"

- Проверьте размер файла (максимум 5MB)
- Убедитесь, что файл является изображением
- Проверьте интернет-соединение

### Изображение не отображается

- Откройте DevTools и проверьте URL изображения
- Убедитесь, что URL сохранился в базе данных
- Проверьте, что в Cloudinary Dashboard появилось новое изображение
