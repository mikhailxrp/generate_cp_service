# üì¶ –°–∏—Å—Ç–µ–º–∞ –∏–º–ø–æ—Ä—Ç–∞ –ø—Ä–∞–π—Å–∞ –∏–∑ CSV

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV-—Ñ–∞–π–ª–æ–≤ –≤ —Ç–∞–±–ª–∏—Ü—É `price_items` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π UPSERT, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

‚úÖ **UPSERT** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π –ø–æ `sku`  
‚úÖ **Stream-–æ–±—Ä–∞–±–æ—Ç–∫–∞** ‚Äî —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ CSV (–Ω–µ –≥—Ä—É–∑–∏—Ç –≤—Å—ë –≤ –ø–∞–º—è—Ç—å)  
‚úÖ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—É –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `attrs`, —á—Ç–æ Excel-–∏–º–ø–æ—Ä—Ç  
‚úÖ **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—à–∏–±–∫–∞–º** ‚Äî –ª–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É  
‚úÖ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** ‚Äî –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤ `csvImportHelpers.js`  
‚úÖ **–®–∞–±–ª–æ–Ω** ‚Äî –±—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –î–æ–∫—É–º–µ–Ω—Ç                                                    | –û–ø–∏—Å–∞–Ω–∏–µ                                       |
| ----------------------------------------------------------- | ---------------------------------------------- |
| **[CSV_IMPORT_QUICKSTART.md](../CSV_IMPORT_QUICKSTART.md)** | üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 5 –º–∏–Ω—É—Ç                    |
| **[CSV_IMPORT_README.md](CSV_IMPORT_README.md)**            | üìñ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π `attrs`   |
| **[CSV_IMPORT_COMMANDS.md](CSV_IMPORT_COMMANDS.md)**        | üìã –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –∏ —á–µ–∫–ª–∏—Å—Ç—ã                    |
| **[EXAMPLES.md](EXAMPLES.md)**                              | üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ |

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install csv-parse
```

‚úÖ **–£–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!**

### 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ CSV

```bash
mkdir data
```

–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ª–∏—Å—Ç—ã –∏–∑ `–ü—Ä–∞–π—Å –†–†–¶.xlsx`:

- `PRICE_INVERTERS` ‚Üí `./data/PRICE_INVERTERS.csv`
- `PRICE_MODULES` ‚Üí `./data/PRICE_MODULES.csv`
- `PRICE_ESS` ‚Üí `./data/PRICE_ESS.csv`

### 3. –ó–∞–ø—É—Å–∫

```bash
# –ò–Ω–≤–µ—Ä—Ç–æ—Ä—ã
node scripts/importInvertersFromCsv.js

# –ü–∞–Ω–µ–ª–∏
node scripts/importModulesFromCsv.js

# ESS
node scripts/importEssFromCsv.js
```

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
scripts/
‚îú‚îÄ‚îÄ üìò README_CSV_IMPORT.md           # –≠—Ç–æ—Ç —Ñ–∞–π–ª (–æ–≥–ª–∞–≤–ª–µ–Ω–∏–µ)
‚îÇ
‚îú‚îÄ‚îÄ üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ CSV_IMPORT_README.md          # –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ CSV_IMPORT_COMMANDS.md        # –ö–æ–º–∞–Ω–¥—ã –∏ —á–µ–∫–ª–∏—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ EXAMPLES.md                   # –ü—Ä–∏–º–µ—Ä—ã –∏ –∫–µ–π—Å—ã
‚îÇ
‚îú‚îÄ‚îÄ üõ†Ô∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ csvImportHelpers.js           # –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ (toNum, toBool, upsert)
‚îÇ   ‚îî‚îÄ‚îÄ importFromCsv.TEMPLATE.js     # –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
‚îÇ
‚îî‚îÄ‚îÄ ‚úÖ –ì–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
    ‚îú‚îÄ‚îÄ importInvertersFromCsv.js     # –ò–º–ø–æ—Ä—Ç –∏–Ω–≤–µ—Ä—Ç–æ—Ä–æ–≤
    ‚îú‚îÄ‚îÄ importModulesFromCsv.js       # –ò–º–ø–æ—Ä—Ç —Å–æ–ª–Ω–µ—á–Ω—ã—Ö –ø–∞–Ω–µ–ª–µ–π
    ‚îî‚îÄ‚îÄ importEssFromCsv.js           # –ò–º–ø–æ—Ä—Ç ESS
```

---

## üîß –°–æ–∑–¥–∞–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–∞ –¥–ª—è –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

### –ó–∞ 3 –º–∏–Ω—É—Ç—ã:

```bash
# 1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —à–∞–±–ª–æ–Ω
cp scripts/importFromCsv.TEMPLATE.js scripts/importBattFromCsv.js

# 2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –∏ –∏–∑–º–µ–Ω–∏—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:
#    - CSV_PATH = "./data/PRICE_BATT.csv"
#    - CATEGORY_CODE = "batt"
#    - TYPE_CODE = "batt"

# 3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –º–∞–ø–ø–∏–Ω–≥–∞ –∏–∑ Excel-—Å–∫—Ä–∏–ø—Ç–∞ (scripts/importBatt.js)

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ
node scripts/importBattFromCsv.js
```

**–ü–æ–¥—Ä–æ–±–Ω–µ–µ:** [EXAMPLES.md ‚Üí –ü—Ä–∏–º–µ—Ä 2](EXAMPLES.md#–ø—Ä–∏–º–µ—Ä-2-—Å–æ–∑–¥–∞–Ω–∏–µ-—Å–∫—Ä–∏–ø—Ç–∞-–¥–ª—è-–±–∞—Ç–∞—Ä–µ–π-batt)

---

## üìä –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

1. **–ß–∏—Ç–∞–µ—Ç CSV –ø–æ—Å—Ç—Ä–æ—á–Ω–æ** (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤)
2. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é** –≤ `price_categories`
3. **–ú–∞–ø–ø–∏—Ç –¥–∞–Ω–Ω—ã–µ** —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é –∏–∑ Excel-—Å–∫—Ä–∏–ø—Ç–∞
4. **UPSERT**: –µ—Å–ª–∏ `sku` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç, –∏–Ω–∞—á–µ ‚Üí –≤—Å—Ç–∞–≤–ª—è–µ—Ç
5. **–õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**:

```
üîÑ –ù–∞—á–∏–Ω–∞—é –∏–º–ø–æ—Ä—Ç: –ò–Ω–≤–µ—Ä—Ç–æ—Ä—ã...
‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏—è 'inverter' –Ω–∞–π–¥–µ–Ω–∞. ID = 2
‚ûï –î–æ–±–∞–≤–ª–µ–Ω–æ: Huawei SUN2000-5KTL-L1 (INV-001)
üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–æ: Growatt MIN 6000TL-XH (INV-002)

üéâ –ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à—ë–Ω.
‚ûï –î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤—ã—Ö: 42
üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–æ: 13
‚ö†Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ: 2
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### ‚ùå –ù–ï –ú–ï–ù–Ø–¢–¨:

- –°—Ö–µ–º—É –ë–î (`price_items`)
- –°—Ç—Ä—É–∫—Ç—É—Ä—É `attrs`:
  ```javascript
  {
    electrical: { ... },
    mechanical: { ... },
    compat: { ... },
    bos: { ... },
    meta: { ... }
  }
  ```
- –ù–∞–∑–≤–∞–Ω–∏—è –∫–ª—é—á–µ–π –≤–Ω—É—Ç—Ä–∏ `attrs` (–æ–Ω–∏ –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å Excel-–∏–º–ø–æ—Ä—Ç–æ–º)
- –õ–æ–≥–∏–∫—É –ø–∞—Ä—Å–µ—Ä–æ–≤ (`toNum`, `toBool`, `parseGridType`)

### ‚úÖ –ú–û–ñ–ù–û –ú–ï–ù–Ø–¢–¨:

- –ü—É—Ç—å –∫ CSV (`./data/PRICE_XXX.csv`)
- –ö–æ–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (`categoryCode`)
- –ö–∞–∫–∏–µ –∫–æ–ª–æ–Ω–∫–∏ CSV —á–∏—Ç–∞—é—Ç—Å—è (`row["–ù–∞–∑–≤–∞–Ω–∏–µ_–∫–æ–ª–æ–Ω–∫–∏"]`)

---

## üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –û—à–∏–±–∫–∞: "–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤—å—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ –ë–î:

```sql
INSERT INTO price_categories (code, title, group_code)
VALUES ('ess', '–°–∏—Å—Ç–µ–º—ã –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏', 'core');
```

### –û—à–∏–±–∫–∞: "Cannot find module 'csv-parse'"

**–†–µ—à–µ–Ω–∏–µ:**

```bash
npm install csv-parse
```

### –û—à–∏–±–∫–∞: –∫–æ–ª–æ–Ω–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–º–µ–Ω–∞ –∫–æ–ª–æ–Ω–æ–∫ –≤ CSV **–¢–û–ß–ù–û** —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å –∫–æ–¥–æ–º:

```javascript
row["–ú–æ—â–Ω–æ—Å—Ç—å_–∫–í—Ç"]  ‚úÖ
row["–º–æ—â–Ω–æ—Å—Ç—å_–∫–≤—Ç"]  ‚ùå
```

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- üöÄ [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](../CSV_IMPORT_QUICKSTART.md) ‚Äî —Å—Ç–∞—Ä—Ç –∑–∞ 5 –º–∏–Ω—É—Ç
- üìñ [–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](CSV_IMPORT_README.md) ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ –ø—Ä–æ `attrs`
- üìã [–ö–æ–º–∞–Ω–¥—ã](CSV_IMPORT_COMMANDS.md) ‚Äî –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- üí° [–ü—Ä–∏–º–µ—Ä—ã](EXAMPLES.md) ‚Äî –∫–µ–π—Å—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ì–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

- [importInvertersFromCsv.js](importInvertersFromCsv.js) ‚Äî –∏–Ω–≤–µ—Ä—Ç–æ—Ä—ã
- [importModulesFromCsv.js](importModulesFromCsv.js) ‚Äî –ø–∞–Ω–µ–ª–∏
- [importEssFromCsv.js](importEssFromCsv.js) ‚Äî ESS

### –£—Ç–∏–ª–∏—Ç—ã

- [csvImportHelpers.js](csvImportHelpers.js) ‚Äî –æ–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [importFromCsv.TEMPLATE.js](importFromCsv.TEMPLATE.js) ‚Äî —à–∞–±–ª–æ–Ω

---

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ CSV-–∏–º–ø–æ—Ä—Ç–∞

| –ö—Ä–∏—Ç–µ—Ä–∏–π            | Excel-–∏–º–ø–æ—Ä—Ç            | CSV-–∏–º–ø–æ—Ä—Ç          |
| ------------------- | ----------------------- | ------------------- |
| **–°–∫–æ—Ä–æ—Å—Ç—å**        | ~1000 —Å—Ç—Ä–æ–∫/–º–∏–Ω         | ~3000 —Å—Ç—Ä–æ–∫/–º–∏–Ω     |
| **–ü–∞–º—è—Ç—å**          | –í–µ—Å—å —Ñ–∞–π–ª –≤ RAM         | Stream (–ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è) |
| **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞**    | –î–æ 10 –ú–ë                | –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω         |
| **CI/CD**           | –°–ª–æ–∂–Ω–æ                  | –õ–µ–≥–∫–æ               |
| **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**   | –ù—É–∂–µ–Ω Excel             | –¢–æ–ª—å–∫–æ CSV          |
| **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** | –¢–∞ –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `attrs` | ‚úÖ                  |

---

## üéØ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

- [ ] CSV –ª–µ–∂–∏—Ç –≤ `./data/`
- [ ] –ó–∞–≥–æ–ª–æ–≤–∫–∏ CSV —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å Excel
- [ ] –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ `price_categories`
- [ ] –§—É–Ω–∫—Ü–∏—è –º–∞–ø–ø–∏–Ω–≥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –∏–∑ Excel-—Å–∫—Ä–∏–ø—Ç–∞
- [ ] –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ (`CSV_PATH`, `CATEGORY_CODE`)
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (5-10 —Å—Ç—Ä–æ–∫) —É—Å–ø–µ—à–µ–Ω
- [ ] –°–¥–µ–ª–∞–Ω –±—ç–∫–∞–ø –ë–î (–µ—Å–ª–∏ –±–æ–µ–≤–æ–π –∏–º–ø–æ—Ä—Ç)

---

## üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–í–æ–ø—Ä–æ—Å—ã?** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. [EXAMPLES.md](EXAMPLES.md) ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –≤–∞—à –∫–µ–π—Å —É–∂–µ —Ä–∞–∑–æ–±—Ä–∞–Ω
2. [CSV_IMPORT_README.md](CSV_IMPORT_README.md) ‚Äî –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
3. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–∫—Ä–∏–ø—Ç—ã: `importInvertersFromCsv.js`, `importModulesFromCsv.js`

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 2025-01-16  
**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–õ–∏—Ü–µ–Ω–∑–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–µ–∫—Ç–µ `generate_service_cp`
